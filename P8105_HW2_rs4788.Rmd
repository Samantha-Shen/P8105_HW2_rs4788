---
title: "P8105_HW2_rs4788"
output: html_document
author: Ruhui Shen rs4788
---

```{r setup}
library(tidyverse)
library(janitor)
library(readxl)
library(dplyr)
```

# Problem 1

### First, deal with pols_month data:
```{r}
polse_month = 
  read.csv("./fivethirtyeight_datasets/pols-month.csv") %>%
  janitor::clean_names() %>%
  separate(mon, into = c("year", "month", "day")) %>%
  mutate(month = month.name[as.integer(month)],
         year = as.numeric(year)) %>%
  pivot_longer(
    cols = c(prez_gop, prez_dem),
    names_to = "president",
    names_prefix = "prez_", 
    values_to = "in_office") %>%
  filter(in_office >= 1) %>%
  select(-day, -in_office)
print(polse_month)
```

### Second, deal with snp data:
```{r}
snp = 
  read.csv("./fivethirtyeight_datasets/snp.csv") %>%
  janitor::clean_names() %>%
  separate(date, into = c("month", "day", "year"),sep = "/") %>%
  mutate(
    year = as.integer(year),
    year = ifelse(year <= 25, 2000 + year, 1900 + year),
    month_num = as.integer(month),  
    month = month.name[month_num]
    ) %>%
  select(year, month, close,month_num) %>%
  arrange(year, month_num,close) %>%
  select(-month_num)
print(as_tibble(snp))
```

### Third, tidy the unemployment data:
```{r}
unemploy= 
  read.csv("./fivethirtyeight_datasets/unemployment.csv") %>%
  pivot_longer(
    Jan:Dec,
    names_to = "month_abb" ,
    values_to = "unemployment_rate") %>% 
  mutate(
    month = month.name[match(month_abb, month.abb)] ,
    year=Year,
    year = as.numeric(year)
  ) %>%
  select(year, month, unemployment_rate) %>%
  arrange(year, month)   
print(unemploy)
```

### Join the datasets:
```{r}
final_dataset =
  left_join(polse_month, snp, by =c("year","month")) %>%
  left_join(unemploy, by =c("year","month"))
print(final_dataset)
```

### Describe the datasets:
Based on the analysis of three datasets, we merged political, financial, and employment indicators into a comprehensive dataset spanning 1947 to 2015. The final merged dataset comprises 822 observations and 11 variables, including key variables such as the president's party affiliation, S&P stock market closing prices, and unemployment rates. This enables a cross-domain analysis of U.S. political and economic trends over nearly seven decades.




# Problem 2

### Mr. Trash Wheel sheet:
```{r}
Mr_TW = 
  read_excel("./Mr. Trash Wheel dataset.xlsx",
             sheet = "Mr. Trash Wheel",
             skip = 1,  
             na = c("", "NA", "N/A")) %>%
  janitor::clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(sports_balls = as.integer(round(sports_balls)),
         trash_wheel = "Mr",
         year = as.numeric(year))
print(Mr_TW)
```

### Professor Trash Wheel and Gwynnda sheet:

Professor Trash Wheel sheet:
```{r}
Pro_TW=
  read_excel("./Mr. Trash Wheel dataset.xlsx",
             sheet = "Professor Trash Wheel",
             skip = 1,  
             na = c("", "NA", "N/A")) %>%
  janitor::clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(trash_wheel = "Professor")
print(Pro_TW)
```

Gwynnda Falls Trash Wheel sheet:
```{r}
Gwy_TW = read_excel("./Mr. Trash Wheel dataset.xlsx",
             sheet = "Gwynns Falls Trash Wheel",
             skip = 1,  
             na = c("", "NA", "N/A")) %>%
  janitor::clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(trash_wheel = "Gwynnda")
print(Gwy_TW)
```

### Combine the data sheets:
```{r}
combined_trash_wheel <- bind_rows(Mr_TW, Pro_TW, Gwy_TW)%>%
  select(-x15, -x16)%>%
  select(trash_wheel, everything())
print(combined_trash_wheel)
```

### Describe the data:
The combined trash wheel dataset contains `r nrow(combined_trash_wheel)` observations from three collection devices operating in Baltimore waterways. Key variables include the weight of trash collected (in tons), volume (in cubic yards), and detailed counts of specific waste items such as plastic bottles, cigarette butts, and sports balls.
Professor Trash Wheel collected `r combined_trash_wheel %>% filter(trash_wheel == "Professor") %>% summarize(sum(weight_tons)) %>% pull()` tons of trash total, while Gwynnda collected `r combined_trash_wheel %>% filter(trash_wheel == "Gwynnda", year == 2022, month == "June") %>% summarize(sum(cigarette_butts)) %>% pull()` cigarette butts in June 2022. These data demonstrate the substantial environmental impact of these innovative trash collection systems.



# Problem 3

### Creat a single, well-organized dataset:

```{r}
zip_df =
  read.csv("./zillow_data/Zip Codes.csv") %>%
  janitor::clean_names()
```


```{r}
zori_df =
  read_csv("./zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") %>%
  janitor::clean_names() 
date_cols = names(zori_df)[10:ncol(zori_df)]
zori_long = zori_df %>%
  pivot_longer(
    cols = all_of(date_cols),
    names_to = "date",
    values_to = "zori"
  )
```


```{r}
final_df = 
  zori_long %>%
  left_join(zip_df, by = c("region_name" = "zip_code"),relationship = "many-to-many")
print(final_df)
```

### Describe dataset:
The resulting tidy dataset contains `r nrow(final_df)` total observations.  
There are `r dplyr::n_distinct(final_df$region_name)` unique ZIP codes represented, and `r dplyr::n_distinct(final_df$neighborhood)` unique neighborhoods.


What about zipcode?

```{r}
missing_zips <- anti_join(
  zip_df, 
  zori_long, 
  by = c("zip_code" = "region_name")
)
```
In total, there are `r nrow(missing_zips)` ZIP codes present in the ZIP code dataset but absent from the Zillow rental price dataset. For example, ZIP codes such as `r paste(head(missing_zips$zip_code, 3), collapse = ", ")` are not included in the Zillow dataset.


Rental price?

```{r}
covid_wide =
  final_df %>%
  filter(date %in% c("x2020_01_31", "x2021_01_31")) %>%
  select(zip_code = region_name, neighborhood, county, date, zori) %>%
  pivot_wider(
    id_cols = c(zip_code, county, neighborhood),
    names_from = date,
    values_from = zori) %>%
  mutate(price_diff = x2021_01_31 - x2020_01_31) %>%
  arrange(price_diff)

largest_drop =
  covid_wide[order(covid_wide$price_diff), c("zip_code","county", "neighborhood", "price_diff")][1:10, ] %>%
  mutate(borough = "Manhattan")
print(largest_drop)
```
As shown in the table, the ten neighborhoods with the largest rental drop between January 2021 and January 2020 were mainly concentrated in core areas such as Lower Manhattan, Chelsea, and Greenwich Village, all located in Manhattan. This indicates that the COVID-19 pandemic had a more pronounced impact on areas with high population density and economic activity.
